from __future__ import annotations

from pyrl.creature.player import Player
from pyrl.types.color import ColorPairs
from pyrl.types.level_gen import LevelGen
from pyrl.creature.creature import Creature
from pyrl.game_data.levels.shared_assets import construct_data, default_dims, DefaultLocation, AssetTileDict, \
    AssetLocationDict, AssetCreatureDict
from pyrl.game_data.pyrl_tiles import PyrlTiles
from pyrl.world.level import Level

def get_level(player: Player) -> Level:

    dimensions = default_dims
    charstr = (
        '################################################################################################'
        '#######################..##################.#.#.#######.....#################################.##'
        '######...##############.#.################.#.#.#.#####.####.###......#######################.@.#'
        '######.##..############.##..#############.######.#..###.###.###.####.########################.##'
        '#######.###...##.######.####.######.....##.#####.#.#.##.###.....###..###.#######################'
        '########.######...#####.#####.#####.###.###.####...##.##.##########.###.#.######################'
        '###.#####.####..#######.######.####...#.###.##########.#.##########.##.##.######################'
        '###.######.###.########.######.######.#.###.########...#.##########....##.######################'
        '###.#######.##.########.######.######.#.###.########.###.################.######################'
        '###..........##.#######.######.#####.##.....########.###.################.######################'
        '###.#######..###.######.##...#.####.################.....########.........######################'
        '###.######...####.#####.##.#...###.##############################.##############################'
        '###.#.###...######.####.##.######.###############################.###...########################'
        '####.#.##..########.###.###.####.################################.##.##........#################'
        '###.#.##.###########.##.####.##.#################################...##########.#################'
        '####.####.###########.#.#####..###############################################.#################'
        '##########.#########.##.######################################################...###############'
        '###########.#######.###.########################################################.###############'
        '############.#####.####........................................................##.##############'
        '#############.###.####.########################################################..>##############'
        '##############.#.##...##########################################################################'
        '###############.###.#.##########################################################################'
        '###############.###...##############################.....................#######################'
        '###############P...###...................................................#######################'
        '#######################################..................................#######################'
        '################################################################################################'
    )
    custom_tiles: AssetTileDict = {
        'P': PyrlTiles.Stairs_Up,
        '@': PyrlTiles.Floor,
    }
    custom_locations: AssetLocationDict = {
        'P': DefaultLocation.Passage_Up,
    }
    custom_creatures: AssetCreatureDict = {
        '@': Creature("The Crone", ('@', ColorPairs.Purple)),
        'P': player,
    }
    level_data = custom_tiles, custom_locations, custom_creatures
    tiles, locations, creatures = construct_data(dimensions, charstr, *level_data)

    return Level(
        danger_level=1,
        generation_type=LevelGen.NoGeneration,
        tiles=tiles,
        locations=locations,
        custom_creatures=creatures,
        creature_spawning_enabled=False,
    )
